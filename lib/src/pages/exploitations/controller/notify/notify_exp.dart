import 'package:get/get.dart';
import 'package:wm_solution/src/api/notifications/departements/exploitation_departement.dart';
import 'package:wm_solution/src/api/notifications/exploitations/production_notify_api.dart';
import 'package:wm_solution/src/api/notifications/exploitations/projet_notify_api.dart';
import 'package:wm_solution/src/models/notify/notify_model.dart';
import 'package:wm_solution/src/models/notify/notify_sum_model.dart';

class NotifyExpController extends GetxController {
  final ProjetNotifyApi projetNotifyApi = ProjetNotifyApi();
  final ProductionNotifyApi productionNotifyApi = ProductionNotifyApi();
  final ExploitationDepartementNotifyApi exploitationDepartementNotifyApi =
      ExploitationDepartementNotifyApi();

  final _itemCount = '0'.obs;
  String get itemCount => _itemCount.value;

  final _itemCountProjetDG = 0.obs;
  int get itemCountProjetDG => _itemCountProjetDG.value;
  final _itemCountProjetBudget = 0.obs;
  int get itemCountProjetBudget => _itemCountProjetBudget.value;
  final _itemCountProjetDD = 0.obs;
  int get itemCountProjetDD => _itemCountProjetDD.value;
  final _itemCountProjetFin = 0.obs;
  int get itemCountProjetFin => _itemCountProjetFin.value;
  final _itemCountProjetObs = 0.obs;
  int get itemCountProjetObs => _itemCountProjetObs.value;

  final _itemCountProductionDG = 0.obs;
  int get itemCountProductionDG => _itemCountProductionDG.value;
  final _itemCounProductionDD = 0.obs;
  int get itemCounProductionDD => _itemCounProductionDD.value;

  @override
  void onInit() {
    super.onInit();
    getCount();
    getCountProjetDG();
    getCountProjetDD();
    getCountProjeteObs();
    getCountProductionDG();
    getCountProductionDD();
  }

  @override
  void refresh() {
    getCount();
    getCountProjetDG();
    getCountProjetDD();
    getCountProjetBudget();
    getCountProjetFin();
    getCountProjeteObs();
    getCountProductionDG();
    getCountProductionDD();
    super.refresh();
  }

  void getCount() async {
    NotifySumModel notifySum =
        await exploitationDepartementNotifyApi.getCountExploitation();
    _itemCount.value = notifySum.sum;
    update();
  }

  void getCountProjetDG() async {
    NotifyModel notifySum = await projetNotifyApi.getCountDG();
    _itemCountProjetDG.value = notifySum.count;
    update();
  }

  void getCountProjetBudget() async {
    NotifyModel notifySum = await projetNotifyApi.getCountBudget();
    _itemCountProjetBudget.value = notifySum.count;
    update();
  }

  void getCountProjetFin() async {
    NotifyModel notifySum = await projetNotifyApi.getCountFin();
    _itemCountProjetFin.value = notifySum.count;
    update();
  }

  void getCountProjetDD() async {
    NotifyModel notifySum = await projetNotifyApi.getCountDD();
    _itemCountProjetDD.value = notifySum.count;
    update();
  }

  void getCountProjeteObs() async {
    NotifyModel notifySum = await projetNotifyApi.getCountObs();
    _itemCountProjetObs.value = notifySum.count;
    update();
  }

  void getCountProductionDG() async {
    NotifyModel notifySum = await productionNotifyApi.getCountDG();
    _itemCountProductionDG.value = notifySum.count;
    update();
  }

  void getCountProductionDD() async {
    NotifyModel notifySum = await productionNotifyApi.getCountDD();
    _itemCounProductionDD.value = notifySum.count;
    update();
  }
}
